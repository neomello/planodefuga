!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b96242a3-173f-4b20-8e99-9c5d3e62aee1",e._sentryDebugIdIdentifier="sentry-dbid-b96242a3-173f-4b20-8e99-9c5d3e62aee1")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4518],{24518:function(e,t,n){n.d(t,{e:function(){return tw}});var r,a,o,s,i=n(95235),c=n(82269),u=n(24256),l=n(69092),p=n(2784),d=n(86861),h=n(94449),f=n(38760),y=n(65257),g=n(52322);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var b=function(e){return(0,g.jsx)(y.k,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e))},v=n(83882),k=n(31544),T=n(63482),w=n(20406),P=n(82841),S=n.n(P),x=n(22219),O=n(72467),C=n(85898),A=n(17831),R=n(72558),Z=n(25711),E=n(45455),I=n.n(E),B=n(55674),D=n(79012),j=n(5272),q=n(10906),N=n(16631),M=n(65119),L=n(75295),F=n(69401),U=n(54986);class V extends U.JU{#e;constructor(e,t,n){let r=Object.assign({},null!=n?n:{},{batchMaxCount:1});(0,F.en)(e&&e.request,"invalid EIP-1193 provider","ethereum",e),super(t,r),this.#e=async(t,n)=>{let r={method:t,params:n};this.emit("debug",{action:"sendEip1193Request",payload:r});try{let t=await e.request(r);return this.emit("debug",{action:"receiveEip1193Result",result:t}),t}catch(t){let e=Error(t.message);throw e.code=t.code,e.data=t.data,e.payload=r,this.emit("debug",{action:"receiveEip1193Error",error:e}),e}}}async send(e,t){return await this._start(),await super.send(e,t)}async _send(e){(0,F.en)(!Array.isArray(e),"EIP-1193 does not support batch request","payload",e);try{let t=await this.#e(e.method,e.params||[]);return[{id:e.id,result:t}]}catch(t){return[{id:e.id,error:{code:t.code,data:t.data,message:t.message}}]}}getRpcError(e,t){switch((t=JSON.parse(JSON.stringify(t))).error.code||-1){case 4001:t.error.message=`ethers-user-denied: ${t.error.message}`;break;case 4200:t.error.message=`ethers-unsupported: ${t.error.message}`}return super.getRpcError(e,t)}async hasSigner(e){null==e&&(e=0);let t=await this.send("eth_accounts",[]);return"number"==typeof e?t.length>e:(e=e.toLowerCase(),0!==t.filter(t=>t.toLowerCase()===e).length)}async getSigner(e){if(null==e&&(e=0),!await this.hasSigner(e))try{await this.#e("eth_requestAccounts",[])}catch(t){let e=t.payload;throw this.getRpcError(e,{id:e.id,error:t})}return await super.getSigner(e)}}var W=n(98747),_=n(89990),H=n(32380),K=n(26880),G=n(55188),z=n(88409),J=n(73968),Y=n(67583),Q=n(7083),X=(r=(0,w.Z)(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:if("WalletConnect"!==t){e.next=6;break}return e.next=5,L.ZP.init({projectId:(0,Y.$p)(),chains:[W.y.id,_.v.id,H.R.id,K.F.id,G.u.id,z.L.id],methods:["personal_sign","eth_sendTransaction"],showQrModal:!0,qrModalOptions:{themeMode:"light"}});case 5:return e.abrupt("return",e.sent);case 6:if(!(window.phantom&&window.phantom.ethereum&&"Phantom"===t)){e.next=8;break}return e.abrupt("return",window.phantom.ethereum);case 8:return e.abrupt("return",window.ethereum);case 9:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)}),$=function(){var e=(0,B.m)().connector,t=null==e?void 0:e.name,n=(0,Q.rI)().blockchain,r=(0,p.useState)(void 0),a=r[0],o=r[1],s=(0,p.useCallback)((0,w.Z)(S().mark(function e(){var r;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(J.A.isEvm(n)){e.next=3;break}return o(void 0),e.abrupt("return");case 3:return e.next=5,X(t);case 5:if(r=e.sent){e.next=8;break}return e.abrupt("return");case 8:o(new V(r));case 9:case"end":return e.stop()}},e)})),[n,t]);return(0,p.useEffect)(function(){s()},[s]),a},ee=n(16480),et=n(10312),en=function(){var e,t=(0,Y.sU)(),n=(0,et.g_)().checkoutType,r=n===et.HX.HOSTED,a=(0,p.useState)(!1),o=a[0],s=a[1];return(0,p.useEffect)(function(){var e;if(r){if(null!==(e=window)&&void 0!==e&&e.grecaptcha)s(!0);else{var n=document.createElement("script");n.src="https://www.google.com/recaptcha/api.js?render=".concat(t),n.async=!0,document.head.appendChild(n),n.onload=function(){s(!0)},n.onerror=function(e){(0,ee.O7)(e)}}}},[t,r,n]),{executeRecaptcha:(0,p.useCallback)((e=(0,w.Z)(S().mark(function e(n){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return(0,D.Jc)("Cannot use this PayLink on embedded checkout. Please use our hosted embed"),(0,ee.O7)(Error("useRecaptchaV3 used on embed")),e.abrupt("return",null);case 4:if(!(o&&window.grecaptcha)){e.next=8;break}return e.next=7,window.grecaptcha.execute(t,{action:n});case 7:return e.abrupt("return",e.sent);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}),[o,t,r])}},er=n(92270),ea=n(35282),eo=n(51764),es=n(4900),ei=n(2283),ec=n(50648),eu=n(24681),el=n(42458),ep=n(82496),ed=n(96412),eh=n(13089),ef=n(41701),ey=n(90129),eg=n(29017),em=n(48200),eb=n(33939),ev=n(68071),ek=function(){function e(){(0,ed.Z)(this,e)}return(0,eh.Z)(e,null,[{key:"getTokenHeader",value:function(e){return e?(0,i.Z)({},"X-HELIO_CAPTCHA_TOKEN",e):{}}}]),e}(),eT=n(2586),ew=n(96332),eP=n(21133),eS=n(51882),ex=n(6848),eO=function(e){(0,ey.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(r);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function r(){return(0,ed.Z)(this,r),n.apply(this,arguments)}return(0,eh.Z)(r)}((0,ex.Z)(Error)),eC=function(e){(0,ey.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(r);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function r(){return(0,ed.Z)(this,r),n.apply(this,arguments)}return(0,eh.Z)(r)}((0,ex.Z)(Error)),eA=n(56473),eR=n(54891),eZ=n(58551);function eE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eI(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eI(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eD=function(e){(0,ey.Z)(a,e);var t,n,r=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(a);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function a(e,t,n){var o;return(0,ed.Z)(this,a),o=r.call(this,e),(0,i.Z)((0,ef.Z)(o),"endpoint","transaction/btc/submit"),(0,i.Z)((0,ef.Z)(o),"prepareEndpoint","/prepare/transaction/btc/paylink"),(0,i.Z)((0,ef.Z)(o),"statusEndpoint","/transaction/btc/status"),(0,i.Z)((0,ef.Z)(o),"prepareFromChargeEndpoint","/charge/prepare-transaction/from-charge"),(0,i.Z)((0,ef.Z)(o),"prepareFromChargeEndpointRoute","btc"),o.chargeId=t,o.chargeToken=n,o}return(0,eh.Z)(a,[{key:"executeTransaction",value:(n=(0,w.Z)(S().mark(function e(t,n){var r,a,o,s,i,c,u,l,p,d,h,f,y,g;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.request,a=n.quantity,o=n.pricingCurrencyRateToken,s=n.discordProps,i=n.accessCodeProps,c=n.customerDetails,u=n.productDetails,l=n.sourceIntegration,p=n.sourceIntegrationVersion,d=n.captchaToken,ee.kg.debug("BTC Paylink Submit Service - running execute transaction"),h=eB(eB(eB({},ev.U.getAuthHeader(i)),eT.j.getAuthHeader(s)),ek.getTokenHeader(d)),f=function(e){return(null==e?void 0:e.name)!=null&&(null==e?void 0:e.value)!=null},!this.chargeToken){e.next=10;break}return e.next=7,this.helioApiAdapter.getPreparedTransactionMessage("".concat(this.prepareFromChargeEndpoint,"/").concat(this.chargeToken,"/").concat(this.prepareFromChargeEndpointRoute),JSON.stringify({account:this.connection.paymentAddress,paymentRequestId:t,btcPublicKey:this.connection.paymentPublicKey,discountToken:r.discountToken,chargeId:this.chargeId}),h);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,this.helioApiAdapter.getPreparedTransactionMessage(this.prepareEndpoint,JSON.stringify(eB(eB({paymentRequestId:t,quantity:a,pricingCurrencyRateToken:o},r),{},{customerDetails:c,productDetails:f(u)?u:void 0,sender:this.connection.paymentAddress,btcPublicKey:this.connection.paymentPublicKey,sourceIntegration:l,sourceIntegrationVersion:p})),h);case 12:e.t0=e.sent;case 13:if(y=e.t0,ee.kg.debug("BTC Paylink Submit Service - got response",{prepareTransactionResponse:y}),y.transactionMessage){e.next=18;break}throw ee.kg.debug("BTC Paylink Submit Service - missing unsigned tx message"),Error("Missing unsigned transaction message");case 18:return e.next=20,this.connection.signBtcTransaction({paymentAddress:this.connection.paymentAddress,unsignedTransaction:y.transactionMessage});case 20:return g=e.sent,ee.kg.debug("BTC Paylink Submit Service - got signed tx"),e.abrupt("return",{signedTx:g.psbtBase64,token:y.transactionToken,headers:h});case 23:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"getTransactionParams",value:function(e){var t=e.amount,n=e.recipientPK,r=e.splitRevenue,a=e.splitWallets,o=e.discountToken;return{amount:String(t),sender:this.connection.paymentAddress,recipient:n,splitRevenue:r,splitWallets:a,discountToken:o}}},{key:"getTransactionPayload",value:function(e,t,n){var r=e.amount,a=e.paymentRequestId,o=e.productDetails,s=e.quantity,i=e.splitRevenue,c=e.splitWallets,u=e.rateToken,l=e.discountToken,p={signedTransaction:t,transactionToken:n,paymentRequestId:a,amount:(0,j.dt)(r),sender:this.connection.paymentAddress,splitRevenue:i,discountToken:l,splitWallets:c,currency:eb.NQ.BITCOIN,network:this.network,quantity:s||1,rateToken:u,paymentCheckoutType:this.chargeToken?x.PaymentCheckoutType.CHARGE:x.PaymentCheckoutType.REGULAR,productDetails:I()(o)?void 0:o};return ee.kg.debug("BTC paylink submit service - get transaction payload",{payload:p}),p}}]),a}(function(){var e,t,n,r,a;function o(e){var t=e.connection,n=e.helioApiAdapter,r=e.generalNetwork,a=e.platform,s=e.apiBasePath;(0,ed.Z)(this,o),ee.kg.debug("BTC Base Payment Service instantiated",{paymentAddress:t.paymentAddress,paymentPublicKey:t.paymentPublicKey}),this.connection=t,this.helioApiAdapter=n,this.generalNetwork=r,this.platform=a,this.network=(0,ew.c_)(x.BlockchainSymbol.BITCOIN,r),this.apiBasePath=s}return(0,eh.Z)(o,[{key:"handleTransaction",value:(e=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ee.kg.debug("BTC Base Payment Service - handle transaction",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eE(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eE(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t)),e.next=3,this.sendTransaction(t.paymentRequestId,{request:this.getTransactionParams(t),quantity:t.quantity?Number(t.quantity):1,splitWallets:t.splitWallets,canSwapTokens:t.canSwapTokens,customerDetails:t.customerDetails,swapRouteToken:t.swapRouteToken,pricingCurrencyRateToken:null==t?void 0:t.rateToken,discordProps:t.discordProps,accessCodeProps:t.accessCodeProps,productDetails:t.productDetails,sourceIntegration:t.sourceIntegration,sourceIntegrationVersion:t.sourceIntegrationVersion,captchaToken:t.captchaToken});case 3:if(null!=(n=e.sent)&&n.signedTx){e.next=11;break}if(ee.kg.debug("BTC Base Payment Service - no signedTx",{sendTransactionResponse:n,props:t}),!t.onCancel){e.next=9;break}return t.onCancel(this.transformTransactionCancelledErrorMessage(n)),e.abrupt("return");case 9:return t.onError({errorMessage:eP.A}),e.abrupt("return");case 11:if(r=n.token,a=n.signedTx,o=n.headers,(0,eR.B)(a)){e.next=16;break}return ee.kg.debug("BTC Base Payment Service - was not valid signed tx",{signedTx:a,props:t}),t.onError({errorMessage:"Failed to send transaction"}),e.abrupt("return");case 16:return s=this.getTransactionPayload(t,a,r),e.next=19,this.handleApprovedTransaction({payload:s,props:t,headers:o});case 19:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"sendTransaction",value:(t=(0,w.Z)(S().mark(function e(t,n){var r,a,o,s,i,c,u,l,p,d,h,f,y;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.request,a=n.quantity,o=n.splitWallets,s=n.canSwapTokens,i=n.swapRouteToken,c=n.pricingCurrencyRateToken,u=n.discordProps,l=n.customerDetails,p=n.accessCodeProps,d=n.productDetails,h=n.sourceIntegration,f=n.sourceIntegrationVersion,y=n.captchaToken,e.prev=1,ee.kg.debug("BTC Base Payment Service - send transaction for payment id ".concat(t),{request:r}),e.next=5,this.executeTransaction(t,{request:r,customerDetails:l,quantity:a,splitWallets:o,canSwapTokens:s,swapRouteToken:i,pricingCurrencyRateToken:c,discordProps:u,accessCodeProps:p,productDetails:d,sourceIntegration:h,sourceIntegrationVersion:f,captchaToken:y});case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(1),(0,ee.O7)(e.t0),e.abrupt("return",{error:new eO(String(e.t0))});case 12:case"end":return e.stop()}},e,this,[[1,8]])})),function(e,n){return t.apply(this,arguments)})},{key:"handleApprovedTransaction",value:(n=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=t.props,a=t.headers,ee.kg.debug("BTC Base Payment Service - handle approved transaction",{payload:n,props:r,headers:a}),e.prev=2,e.next=5,this.approveTransactionByType(n,a);case 5:return o=e.sent,e.next=8,this.handleApproveResponse(o,r);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),(0,ee.O7)(e.t0),null===(s=r.onError)||void 0===s||s.call(r,{errorMessage:"Failed to submit transaction"});case 14:case"end":return e.stop()}},e,this,[[2,10]])})),function(e){return n.apply(this,arguments)})},{key:"handleApproveResponse",value:(r=(0,w.Z)(S().mark(function e(t,n){var r;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ee.kg.debug("BTC Base Payment Service - handle approved response - status ".concat(t.status),{approveResponse:t,props:n}),null!=t.status){e.next=4;break}throw ee.kg.debug("BTC Base Payment Service - unsupported empty status"),Error("Unsupported empty status");case 4:e.t0=t.status,e.next=e.t0===x.TransactionStatus.PENDING?7:e.t0===x.TransactionStatus.INITIATED?7:e.t0===x.TransactionStatus.FAILED?10:e.t0===x.TransactionStatus.SUCCESS?13:15;break;case 7:return ee.kg.debug("BTC Base Payment Service - running onPending",{approveResponse:t}),n.onPending({transaction:t.transactionSignature,redirectUrl:t.redirectUrl,blockchainSymbol:x.BlockchainSymbol.BITCOIN,data:t}),e.abrupt("return");case 10:return ee.kg.debug("BTC Base Payment Service - Running onError (failed status)"),(0,ee.O7)(Error("BitcoinBasePaymentService - transaction status failed")),e.abrupt("return",null===(r=n.onError)||void 0===r?void 0:r.call(n,{errorMessage:"Failed to submit transaction"}));case 13:return ee.kg.debug("BTC Base Payment Service - success",{approveResponse:t}),e.abrupt("return",n.onSuccess({transaction:t.transactionSignature,redirectUrl:t.redirectUrl,data:t,blockchainSymbol:x.BlockchainSymbol.BITCOIN,swapTransactionSignature:(0,eZ.qK)(t)?t.swapTransactionSignature:void 0}));case 15:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)})},{key:"approveTransactionByType",value:(a=(0,w.Z)(S().mark(function e(t,n){var r,a;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ee.kg.debug("BTC - approve transaction by type",{payload:t,headers:n}),e.next=3,(0,eA.g8)(this.platform,this.apiBasePath,"/".concat(this.endpoint),{method:"POST",body:JSON.stringify(t),headers:n});case 3:return r=e.sent,e.next=6,r.json();case 6:if(a=e.sent,ee.kg.debug("BTC Base Payment Service - called approveTransactionByType",{result:a}),r.status!==eS.o.CREATED){e.next=10;break}return e.abrupt("return",a);case 10:if(r.status!==eS.o.FAILED_DEPENDENCY){e.next=12;break}throw new eC(a.message);case 12:throw Error(a.message);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"transformTransactionCancelledErrorMessage",value:function(e){var t;return null!=e&&null!==(t=e.error)&&void 0!==t&&t.message?RegExp("Not enough utxo for amount","i").test(e.error.message)?{errorMessage:"You don't have sufficient balance for the BTC gas/output fees"}:{errorMessage:"An unknown error occurred"}:void 0}}]),o}()),ej=n(95587),eq=n(67567),eN=n(19674),eM=function(e){(0,ey.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(r);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function r(e){return(0,ed.Z)(this,r),n.call(this,e)}return(0,eh.Z)(r,[{key:"extractSignature",value:function(){return(0,j.Wf)(this.message,"signature","using")}}]),r}((0,ex.Z)(Error)),eL=n(96131),eF=function(){var e,t,n,r,a,o,s,i;function c(e,t,n,r){(0,ed.Z)(this,c),this.helioApiAdapter=e,this.generalNetwork=t,this.platform=n,this.apiBasePath=r}return(0,eh.Z)(c,[{key:"init",value:(e=(0,w.Z)(S().mark(function e(t){var n,r,a;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.mintAddress,r=t.blockchain,a=t.isNativeMintAddress,this.blockchain=r,this.mintAddress=n,this.isNativeMintAddress=a;case 4:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"handleTransaction",value:(t=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s,i,c,u,l,p,d,h,f,y,g;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init(t);case 2:return o=null!==(n=null!==(r=(a=t).paymentId)&&void 0!==r?r:a.paymentStateId)&&void 0!==n?n:a.paymentRequestId,s=a.quantity?Number(a.quantity):1,i=a.splitWallets,c=!!a.canSwapTokens,u=String(a.swapRouteToken),e.next=10,this.getTransactionParams(t);case 10:return l=e.sent,e.next=13,this.sendTransaction(String(o),a.anchorProvider,{request:l,symbol:t.symbol,quantity:s,splitWallets:i,canSwapTokens:c,swapRouteToken:u,pricingCurrencyRateToken:null==t?void 0:t.rateToken,discordProps:t.discordProps,accessCodeProps:t.accessCodeProps,customerDetails:t.customerDetails,productDetails:t.productDetails,setLoadingModalStep:t.setLoadingModalStep,mintAddress:t.mintAddress,sourceIntegration:t.sourceIntegration,sourceIntegrationVersion:t.sourceIntegrationVersion});case 13:if(null!=(p=e.sent)&&p.signedTx){e.next=17;break}return t.onCancel(null!=p&&null!==(d=p.error)&&void 0!==d&&d.message?{errorMessage:p.error.message}:void 0),e.abrupt("return");case 17:if(h=p.token,f=p.signedTx,y=p.swapSignedTx,(0,eR.B)(f)){e.next=21;break}return t.onError({errorMessage:"Transaction canceled"}),e.abrupt("return");case 21:return e.next=23,this.getTransactionPayload(t,f,h,y);case 23:return g=e.sent,e.next=26,this.handleApprovedTransaction({payload:g,props:t});case 26:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"executeCommand",value:(n=(0,w.Z)(S().mark(function e(t,n){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),(0,ee.O7)(e.t0),n("Unable to verify the transaction.");case 9:case"end":return e.stop()}},e,null,[[0,5]])})),function(e,t){return n.apply(this,arguments)})},{key:"sendTransaction",value:(r=(0,w.Z)(S().mark(function e(t,n,r){var a,o,s,i,c,u,l,p,d,h,f,y,g,m,b;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.request,o=r.symbol,s=r.quantity,i=r.splitWallets,c=r.canSwapTokens,u=r.swapRouteToken,l=r.pricingCurrencyRateToken,p=r.discordProps,d=r.accessCodeProps,h=r.customerDetails,f=r.productDetails,y=r.mintAddress,g=r.setLoadingModalStep,m=r.sourceIntegration,b=r.sourceIntegrationVersion,e.prev=1,e.next=4,this.executeTransaction(t,n,{request:a,symbol:o,quantity:s,splitWallets:i,canSwapTokens:c,swapRouteToken:u,pricingCurrencyRateToken:l,discordProps:p,accessCodeProps:d,customerDetails:h,productDetails:f,mintAddress:y,setLoadingModalStep:g,sourceIntegration:m,sourceIntegrationVersion:b});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),(0,ee.O7)(e.t0),e.abrupt("return",{error:new eM(String(e.t0))});case 11:case"end":return e.stop()}},e,this,[[1,7]])})),function(e,t,n){return r.apply(this,arguments)})},{key:"approveTransaction",value:(a=(0,w.Z)(S().mark(function e(t){var n,r;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,eA.g8)(this.platform,this.apiBasePath,"/".concat(this.endpoint),{method:"POST",body:JSON.stringify(t)});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,n.status!==eS.o.CREATED){e.next=8;break}return e.abrupt("return",r);case 8:if(n.status!==eS.o.FAILED_DEPENDENCY){e.next=10;break}throw new eL.S(r.message);case 10:throw Error(r.message);case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"handleApprovedTransaction",value:(o=(0,w.Z)(S().mark(function e(t){var n,r,a,o;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.payload,r=t.props,e.prev=1,e.next=4,this.approveTransaction(n);case 4:return a=e.sent,e.next=7,this.handleApproveResponse(a,r,n);case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),(0,ee.O7)(e.t0),null===(o=r.onError)||void 0===o||o.call(r,{errorMessage:"Failed to submit transaction"});case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(e){return o.apply(this,arguments)})},{key:"handleApproveResponse",value:(s=(0,w.Z)(S().mark(function e(t,n,r){var a,o;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.status,e.next=e.t0===x.TransactionStatus.PENDING?3:e.t0===x.TransactionStatus.INITIATED?3:e.t0===x.TransactionStatus.FAILED?5:e.t0===x.TransactionStatus.SUCCESS?6:7;break;case 3:return null===(a=n.onPending)||void 0===a||a.call(n,{transaction:t.transactionSignature}),e.abrupt("return",this.checkStatus(n,r,t.statusToken));case 5:return e.abrupt("return",null===(o=n.onError)||void 0===o?void 0:o.call(n,{errorMessage:"Failed to submit transaction"}));case 6:return e.abrupt("return",this.onSuccess(t,n.onSuccess,r));case 7:case"end":return e.stop()}},e,this)})),function(e,t,n){return s.apply(this,arguments)})},{key:"checkStatus",value:(i=(0,w.Z)(S().mark(function e(t,n,r){var a,o;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r){e.next=3;break}return t.onError({errorMessage:"Unable to check transaction status"}),e.abrupt("return");case 3:return a=5*eN.vL,e.next=6,(0,j.gw)(a);case 6:return e.next=8,this.helioApiAdapter.getTransactionStatus(r,this.statusEndpoint);case 8:return o=e.sent,e.abrupt("return",this.handleApproveResponse(o,t,n));case 10:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)})},{key:"onSuccess",value:function(e,t,n){t({transaction:e.transactionSignature,redirectUrl:e.redirectUrl,data:e,blockchainSymbol:this.blockchain,swapTransactionSignature:(0,eZ.qK)(e)?null==e?void 0:e.swapTransactionSignature:void 0})}}]),c}(),eU=n(10663),eV=n(30593),eW=n(23669),e_=(a=(0,w.Z)(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.send("eth_requestAccounts",[]);case 2:return e.abrupt("return",t.getSigner());case 3:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),eH=(o=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s,i,c,u,l,p,d,h,f;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.prepareTransactionResponse,r=t.provider,a=t.tokenAddress,o=t.isNativeTokenAddress,s=t.setLoadingModalStep,e.next=3,e_(r);case 3:if(i=e.sent,!((c=(0,eW.Z)(n.transactionToken).finalAmount)&&null!=a&&!o)){e.next=28;break}return e.next=9,r.getNetwork();case 9:return u=e.sent.chainId,l=function(){var e=(0,w.Z)(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,eU.requestTokenAmountApproval)(i,BigInt(t),Number(u),a);case 2:return e.next=4,e.sent.wait();case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.prev=11,e.next=14,l(c);case 14:e.next=28;break;case 16:if(e.prev=16,e.t0=e.catch(11),!("0xdac17f958d2ee523a2206206994597c13d831ec7"!==a.toLowerCase())){e.next=21;break}throw ee.kg.error("Approval failed, but as it was not USDT not retrying with 0. Token address: "+a),e.t0;case 21:return ee.kg.debug("USDT Error approving, going to approve 0 first. Error: "+String(e.t0)),e.next=24,l("0");case 24:return ee.kg.debug("USDT Approved 0, now retrying original approve"),e.next=27,l(c);case 27:ee.kg.debug("USDT successfully Approved ".concat(c));case 28:return null==s||s(el.T.SIGN_TRANSACTION),p=eV.Y.from(n.transactionMessage),e.next=32,i.getAddress();case 32:return d=e.sent,e.next=35,r.getTransactionCount(d);case 35:return p.nonce=e.sent,e.next=38,eK(p);case 38:return h=e.sent,e.next=41,i.sendTransaction(h);case 41:return f=e.sent,e.abrupt("return",f);case 43:case"end":return e.stop()}},e,null,[[11,16]])})),function(e){return o.apply(this,arguments)}),eK=(s=(0,w.Z)(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{nonce:t.nonce,to:t.to,value:t.value,gasLimit:t.gasLimit,data:t.data,gasPrice:t.gasPrice,chainId:t.chainId});case 1:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)}),eG=n(15766),ez=n(10718),eJ=function(e,t,n){var r;switch(n){case x.BlockchainSymbol.POLYGON:r=(0,ew.c_)(n,t)===ew.Gv[n].mainnet?eU.ChainId.POLYGON_MAINNET:eU.ChainId.POLYGON_MUMBAI;break;case x.BlockchainSymbol.ETH:r=(0,ew.c_)(n,t)===ew.Gv[n].mainnet?eU.ChainId.ETHEREUM_MAINNET:eU.ChainId.ETHEREUM_SEPOLIA;break;case x.BlockchainSymbol.BASE:r=(0,ew.c_)(n,t)===ew.Gv[n].mainnet?eU.ChainId.BASE_MAINNET:eU.ChainId.BASE_SEPOLIA}if(e!==r)throw(0,eG._)({name:ez.Z.WALLET_CHAIN_MISMATCH,properties:{blockchain:null!=n?n:x.BlockchainSymbol.ETH}}),Error("Set a default wallet in Phantom (Preferences â†’ Default Wallet App) and try again.")};function eY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eY(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var eX=function(e){(0,ey.Z)(c,e);var t,n,r,a,o,s,i=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(c);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function c(){return(0,ed.Z)(this,c),i.apply(this,arguments)}return(0,eh.Z)(c,[{key:"init",value:(n=(0,w.Z)(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,eq.Z)((0,em.Z)(c.prototype),"init",this).call(this,t);case 2:this.chargeId=t.chargeId,this.chargeToken=t.chargeToken;case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"executeTransaction",value:(r=(0,w.Z)(S().mark(function e(t,n,r){var a,o,s,i,c,u,l,p,d,h,f,y;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.request,o=r.symbol,s=r.quantity,r.splitWallets,r.canSwapTokens,r.swapRouteToken,i=r.pricingCurrencyRateToken,c=r.discordProps,u=r.accessCodeProps,l=r.customerDetails,p=r.productDetails,d=r.setLoadingModalStep,h=r.mintAddress,f=r.sourceIntegration,y=r.sourceIntegrationVersion,!(n&&a)){e.next=9;break}return e.next=4,n.getNetwork();case 4:return eJ(Number(e.sent.chainId),this.generalNetwork,this.blockchain),e.abrupt("return",this.getAndSignSinglePaymentTx({provider:n,request:a,symbol:o,paymentRequestId:t,quantity:s,pricingCurrencyRateToken:i,accessCodeProps:u,discordProps:c,customerDetails:l,productDetails:p,mintAddress:h,setLoadingModalStep:d,sourceIntegration:f,sourceIntegrationVersion:y}));case 9:throw Error("Connection or wallet is not defined");case 10:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"getTransactionParams",value:(a=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.amount,r=t.anchorProvider,a=t.recipientPK,t.splitRevenue,t.splitWallets,o=t.discountToken,e.next=3,r.getSigner();case 3:return e.next=5,e.sent.getAddress();case 5:if(s=e.sent){e.next=8;break}throw Error("Public key is invalid");case 8:return e.abrupt("return",{amount:String(n),sender:s,recipient:a,mintAddress:this.mintAddress,discountToken:o});case 9:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getTransactionPayload",value:(o=(0,w.Z)(S().mark(function e(t,n,r,a){var o,s,i,c,u,l,p,d,h,f,y,g,m,b;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.amount,s=t.paymentRequestId,i=t.anchorProvider,c=t.recipientPK,u=t.symbol,l=t.customerDetails,p=t.productDetails,d=t.quantity,h=t.splitRevenue,f=t.splitWallets,y=t.rateToken,g=t.discountToken,m=I()(p)?{}:{productDetails:p},e.next=4,i.getSigner();case 4:return e.next=6,e.sent.getAddress();case 6:return b=e.sent,e.abrupt("return",eQ({signedTransaction:n,signedSwapTransaction:a,transactionToken:r,paymentRequestId:s,amount:(0,j.dt)(o),sender:b,recipient:c,splitRevenue:h,discountToken:g,splitWallets:f,currency:u,customerDetails:l,paymentCheckoutType:this.chargeToken?x.PaymentCheckoutType.CHARGE:x.PaymentCheckoutType.REGULAR,quantity:d||1,rateToken:y},m));case 8:case"end":return e.stop()}},e,this)})),function(e,t,n,r){return o.apply(this,arguments)})},{key:"getAndSignSinglePaymentTx",value:(s=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s,i,c,u,l,p,d,h,f,y,g,m;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.provider,r=t.request,a=t.symbol,o=t.paymentRequestId,s=t.quantity,i=t.pricingCurrencyRateToken,c=t.accessCodeProps,u=t.discordProps,l=t.customerDetails,p=t.productDetails,d=t.setLoadingModalStep,h=t.sourceIntegration,f=t.sourceIntegrationVersion,y=eQ(eQ({},ev.U.getAuthHeader(c)),eT.j.getAuthHeader(u)),!this.chargeToken){e.next=8;break}return e.next=5,this.helioApiAdapter.getPreparedTransactionMessage("".concat(this.prepareFromChargeEndpoint,"/").concat(this.chargeToken,"/").concat(this.prepareFromChargeEndpointRoute),JSON.stringify({account:r.sender,paymentRequestId:o,discountToken:r.discountToken,chargeId:this.chargeId}),y);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,this.helioApiAdapter.getPreparedTransactionMessage(this.prepareEndpoint,JSON.stringify(eQ({paymentRequestId:o,currency:a,quantity:s,pricingCurrencyRateToken:i,customerDetails:l,productDetails:I()(p)?void 0:p,sourceIntegration:h,sourceIntegrationVersion:f},r)),y);case 10:e.t0=e.sent;case 11:return g=e.t0,e.next=14,eH({prepareTransactionResponse:g,tokenAddress:this.mintAddress,isNativeTokenAddress:this.isNativeMintAddress,provider:n,setLoadingModalStep:d});case 14:return m=e.sent,null==d||d(el.T.SUBMIT_TRANSACTION),e.abrupt("return",{signedTx:JSON.stringify(m),token:g.transactionToken});case 17:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})}]),c}(eF),e$=function(e){(0,ey.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(r);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function r(){var e;(0,ed.Z)(this,r);for(var t=arguments.length,a=Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),(0,i.Z)((0,ef.Z)(e),"endpoint","transaction/base/submit"),(0,i.Z)((0,ef.Z)(e),"prepareEndpoint","/prepare/transaction/base/paylink"),(0,i.Z)((0,ef.Z)(e),"statusEndpoint","/transaction/base/status"),(0,i.Z)((0,ef.Z)(e),"createChargeEndpoint","/charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpoint","/charge/prepare-transaction/from-charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpointRoute","base"),(0,i.Z)((0,ef.Z)(e),"blockchain",x.BlockchainSymbol.BASE),e}return(0,eh.Z)(r)}(eX),e0=function(e){(0,ey.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(r);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function r(){var e;(0,ed.Z)(this,r);for(var t=arguments.length,a=Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),(0,i.Z)((0,ef.Z)(e),"endpoint","transaction/eth/submit"),(0,i.Z)((0,ef.Z)(e),"prepareEndpoint","/prepare/transaction/eth/paylink"),(0,i.Z)((0,ef.Z)(e),"statusEndpoint","/transaction/eth/status"),(0,i.Z)((0,ef.Z)(e),"createChargeEndpoint","/charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpoint","/charge/prepare-transaction/from-charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpointRoute","eth"),(0,i.Z)((0,ef.Z)(e),"blockchain",x.BlockchainSymbol.ETH),e}return(0,eh.Z)(r)}(eX),e1=function(e){(0,ey.Z)(r,e);var t,n=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(r);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function r(){var e;(0,ed.Z)(this,r);for(var t=arguments.length,a=Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),(0,i.Z)((0,ef.Z)(e),"endpoint","transaction/polygon/submit"),(0,i.Z)((0,ef.Z)(e),"prepareEndpoint","/prepare/transaction/polygon/paylink"),(0,i.Z)((0,ef.Z)(e),"statusEndpoint","/transaction/polygon/status"),(0,i.Z)((0,ef.Z)(e),"createChargeEndpoint","/charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpoint","/charge/prepare-transaction/from-charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpointRoute","polygon"),(0,i.Z)((0,ef.Z)(e),"blockchain",x.BlockchainSymbol.POLYGON),e}return(0,eh.Z)(r)}(eX),e2=n(8529),e3=n(10856),e8=n(38652);n(1738);var e5=n(20603),e9=n(7572),e7=n(25875);function e4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e6(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e4(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e4(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var te=function(e){(0,ey.Z)(u,e);var t,n,r,a,o,s,c=(t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=(0,em.Z)(u);return e=t?Reflect.construct(n,arguments,(0,em.Z)(this).constructor):n.apply(this,arguments),(0,eg.Z)(this,e)});function u(){var e;(0,ed.Z)(this,u);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=c.call.apply(c,[this].concat(n)),(0,i.Z)((0,ef.Z)(e),"endpoint","transaction/submit"),(0,i.Z)((0,ef.Z)(e),"prepareEndpoint","/prepare/transaction/sol/paylink"),(0,i.Z)((0,ef.Z)(e),"statusEndpoint","/transaction/status"),(0,i.Z)((0,ef.Z)(e),"createChargeEndpoint","/charge"),(0,i.Z)((0,ef.Z)(e),"prepareFromChargeEndpoint","/charge/prepare-transaction/from-charge"),e}return(0,eh.Z)(u,[{key:"init",value:(n=(0,w.Z)(S().mark(function e(t){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,eq.Z)((0,em.Z)(u.prototype),"init",this).call(this,t);case 2:this.chargeId=t.chargeId,this.chargeToken=t.chargeToken;case 4:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"executeTransaction",value:(r=(0,w.Z)(S().mark(function e(t,n){var r,a,o,s,i,c,u,l,p,d,h,f,y,g,m,b,v;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.request,a=n.symbol,o=n.quantity,s=n.canSwapTokens,i=n.swapRouteToken,c=n.pricingCurrencyRateToken,u=n.discordProps,l=n.accessCodeProps,p=n.affiliateCode,d=n.customerDetails,h=n.setLoadingModalStep,f=n.productDetails,y=n.sourceIntegrationVersion,g=n.sourceIntegration,m=n.telegramUser,!(!this.connection||!this.wallet||!r)){e.next=3;break}throw Error("Connection or wallet is not defined");case 3:var k;if(b={wallet:this.wallet,request:r,symbol:a,paymentRequestId:t,quantity:o,discordProps:u,accessCodeProps:l,affiliateCode:p,sourceIntegrationVersion:y,sourceIntegration:g,setLoadingModalStep:h,pricingCurrencyRateToken:c,customerDetails:e6(e6({},d),{},{telegramUser:m}),productDetails:(null==(k=f)?void 0:k.name)!=null&&(null==k?void 0:k.value)!=null?k:void 0},v=e6(e6({},ev.U.getAuthHeader(l)),eT.j.getAuthHeader(u)),!(i&&s)){e.next=7;break}return e.abrupt("return",this.getAndSignSwapPaymentTx(e6(e6({},b),{},{swapRoute:i}),v));case 7:return e.abrupt("return",this.getAndSignNonSwapPaymentTx(e6({},b),v));case 8:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"getTransactionParams",value:function(e){var t=e.amount,n=e.anchorProvider,r=e.recipientPK,a=e.splitRevenue,o=e.splitWallets,s=e.discountToken;if(!n.provider.publicKey)throw Error("Public key is invalid");return{amount:String(t),sender:n.provider.publicKey,recipient:new e3.nh(r),mintAddress:this.mintAddress,splitRevenue:a,splitWallets:o,discountToken:s}}},{key:"getTransactionPayload",value:function(e,t,n,r,a,o){var s=e.amount,i=e.paymentRequestId,c=e.anchorProvider,u=e.recipientPK,l=e.symbol,p=e.customerDetails,d=e.productDetails,h=e.quantity,f=e.splitRevenue,y=e.splitWallets,g=e.rateToken,m=e.discountToken,b=e.affiliateCode,v=e.telegramUser,k=I()(d)?{}:{productDetails:d};return e6({signedTransaction:t,signedSwapTransaction:r,transactionToken:n,paymentRequestId:i,amount:(0,j.dt)(s),sender:c.provider.publicKey.toBase58(),recipient:u,splitRevenue:f,discountToken:m,splitWallets:y,currency:l,network:this.network,customerDetails:e6(e6({},p),{},{telegramUser:v}),quantity:h||1,rateToken:g,paymentCheckoutType:this.chargeToken?x.PaymentCheckoutType.CHARGE:x.PaymentCheckoutType.REGULAR,affiliateCode:b,addressLookupTableAccounts:o},k)}},{key:"getAndSignSwapPaymentTx",value:(a=(0,w.Z)(S().mark(function e(t,n){var r,a,o,s,i,c,u,l,p,d,h,f,y,g,m,b,v,k,T,w,P,O,C,A,R,Z,E;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.wallet,o=t.request,s=t.symbol,i=t.paymentRequestId,c=t.quantity,u=t.swapRoute,l=t.pricingCurrencyRateToken,t.discordProps,t.accessCodeProps,p=t.affiliateCode,d=t.customerDetails,h=t.productDetails,f=t.sourceIntegrationVersion,y=t.sourceIntegration,g=t.setLoadingModalStep,m=this.chargeToken?"".concat(this.prepareFromChargeEndpoint,"/").concat(this.chargeToken,"/swap"):this.prepareEndpoint+"/swap",b={paymentRequestId:i,swapRouteToken:u},v=this.chargeToken?e6(e6({},b),{},{account:o.sender,discountToken:null==o?void 0:o.discountToken,chargeId:this.chargeId}):e6(e6({},b),{},{currency:s,quantity:c,pricingCurrencyRateToken:l,affiliateCode:p,amount:o.amount,sender:o.sender,recipient:o.recipient,mintAddress:o.mintAddress,discountToken:null==o?void 0:o.discountToken,sourceIntegrationVersion:f,sourceIntegration:y,solanaTransactionVersion:x.SolanaTransactionVersion.V0,customerDetails:d,productDetails:h}),e.next=6,this.helioApiAdapter.getPreparedTransactionSwapMessage(m,JSON.stringify(v),n);case 6:if(T=null==(k=e.sent)?void 0:k.swapTransaction,w=x.SolanaSerializationService.deserializeVersionedTransaction(null!==(r=null==k?void 0:k.standardTransaction.serializedTransaction)&&void 0!==r?r:"")){e.next=11;break}throw Error("Swap Transaction could not be deserialized");case 11:if(!T){e.next=25;break}if(C=x.SolanaSerializationService.deserializeVersionedTransaction(T)){e.next=15;break}throw Error("Swap transaction could not be deserialized");case 15:return e.next=17,a.signAllTransactions([C,w]);case 17:A=e.sent,Z=(R=(0,e2.Z)(A,2))[0],E=R[1],O=x.SolanaSerializationService.serializeVersionedTransaction(Z),P=x.SolanaSerializationService.serializeVersionedTransaction(E),e.next=29;break;case 25:return O="",e.next=28,(0,e7.PO)(w,a);case 28:P=e.sent;case 29:return null==g||g(e5.LoadingModalStep.SUBMIT_TRANSACTION),e.abrupt("return",{swapSignedTx:O,signedTx:P,token:null==k?void 0:k.standardTransaction.transactionToken,headers:n,addressLookupTableAccounts:k.standardTransaction.addressLookupTableAccounts});case 31:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"handleCreateCharge",value:(o=(0,w.Z)(S().mark(function e(t){var n,r,a,o,s,i,c,u,l,p,d;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init(t);case 2:return o=null!==(n=null!==(r=(a=t).paymentId)&&void 0!==r?r:a.paymentStateId)&&void 0!==n?n:a.paymentRequestId,s=a.quantity?Number(a.quantity):1,i=a.splitWallets,c=a.canSwapTokens,u=a.swapRouteToken,l=e6(e6({},ev.U.getAuthHeader(t.accessCodeProps)),eT.j.getAuthHeader(t.discordProps)),p=this.getTransactionParams(t),d=(0,e8.Z)(),e.next=13,this.helioApiAdapter.getAndCreateTransactionChargeData(this.createChargeEndpoint,{paymentRequestId:o,paylink:o,requestAmount:t.amount.toString(),currencySymbol:t.symbol,token:d,prepareRequestBody:e6(e6({canSwapTokens:c,splitWallets:i,swapRouteToken:u,paymentRequestId:t.paymentRequestId,currency:t.symbol,quantity:s,pricingCurrencyRateToken:t.rateToken,affiliateCode:t.affiliateCode,customerDetails:t.customerDetails,productDetails:t.productDetails,sourceIntegrationVersion:t.sourceIntegrationVersion,sourceIntegration:t.sourceIntegration,solanaTransactionVersion:x.SolanaTransactionVersion.V0},p),{},{sender:p.sender.toBase58()})},l);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getAndSignNonSwapPaymentTx",value:(s=(0,w.Z)(S().mark(function e(t,n){var r,a,o,s,i,c,u,l,p,d,h,f,y,g,m,b;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.wallet,o=t.request,s=t.symbol,i=t.paymentRequestId,c=t.quantity,u=t.pricingCurrencyRateToken,t.discordProps,t.accessCodeProps,l=t.affiliateCode,p=t.customerDetails,d=t.productDetails,h=t.sourceIntegrationVersion,f=t.sourceIntegration,y=t.setLoadingModalStep,!this.chargeToken){e.next=7;break}return e.next=4,this.helioApiAdapter.getPreparedTransactionMessage("".concat(this.prepareFromChargeEndpoint,"/").concat(this.chargeToken),JSON.stringify({account:o.sender,paymentRequestId:i,discountToken:o.discountToken,chargeId:this.chargeId}),n);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,this.helioApiAdapter.getPreparedTransactionMessage(this.prepareEndpoint+this.getQueryParams(),JSON.stringify(e6({paymentRequestId:i,currency:s,quantity:c,pricingCurrencyRateToken:u,affiliateCode:l,customerDetails:p,productDetails:d,sourceIntegrationVersion:h,sourceIntegration:f,solanaTransactionVersion:x.SolanaTransactionVersion.V0},o)),n);case 9:e.t0=e.sent;case 10:if(g=e.t0,m=x.SolanaSerializationService.deserializeVersionedTransaction(null!==(r=null==g?void 0:g.serializedTransaction)&&void 0!==r?r:"")){e.next=14;break}throw Error("Transaction could not be deserialized");case 14:return e.next=16,(0,e7.PO)(m,a);case 16:return b=e.sent,null==y||y(e5.LoadingModalStep.SUBMIT_TRANSACTION),e.abrupt("return",{signedTx:b,token:g.transactionToken,addressLookupTableAccounts:g.addressLookupTableAccounts,headers:n});case 19:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"getQueryParams",value:function(){return"?feePayer=".concat(x.FeePayer.HELIO)}}]),u}(e9.h),tt=n(23970),tn=(0,p.createContext)({}),tr=n(95503),ta=n(14546),to=n(16017),ts=n(50975),ti=n(33381),tc=function(e){var t=e.openAddFundsModal,n=e.balancesLoading,r=e.isAddFundsModalShown;return(0,g.jsx)(ea.z,{onClick:function(){return t()},className:"hel-text-sm hel-rounded-full",variant:"primary",children:n?eu.LE:r?eu.VC:"Add funds"})};function tu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tu(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tu(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var tp=function(e){var t,n,r,a,o,s=e.decimalAmount,i=e.receiverPublicKey,c=e.paymentRequestId,u=e.isFormSubmitted,l=e.type,d=e.customerDetails,f=e.quantity,y=e.productDetails,m=e.splitRevenue,b=e.splitWallets,v=e.canSwapTokens,k=void 0===v||v,T=e.resetFormSubmitted,P=e.buttonText,E=e.discountToken,L=e.discountPercent,F=e.airdropIsNotConfigured,U=e.affiliateCode,V=e.requireCaptchaValidation,W=e.recipients,_=(0,B.m)().address,H=(0,C.z)(),K=(0,q.jc)(),G=(0,A.R)(),z=(0,O.Eu)().payload,J=(0,p.useContext)(tn).payButtonTitle,Y=(0,q.mN)().setAmountToApprove,X=en().executeRecaptcha,ed=(0,q.Oo)().apiServiceV1,eh=(0,tt.v)().buttonDropShadow,ef=(0,Q.rI)(),ey=ef.blockchain,eg=ef.currency,em=$(),eb=(0,q.tq)(),ev=eb.discordAuth,ek=eb.accessCodeAuth,eT=eb.telegramAuth.telegramUser,ew=(0,er.p)(),eP=ew.rateToken,eS=ew.loading,ex=(0,M.U)(),eO=ex.currencyService,eC=ex.tokenConversionService,eA=(0,et.g_)(),eR=eA.network,eZ=eA.platform,eE=eA.apiBasePath,eI=eA.enableCharge,eB=eA.forceReplace,eq=(0,Z.u6)(),eN=(0,q.H4)(),eM=eN.onSuccess,eL=eN.onPending,eF=eN.onError,eU=eN.onInitiated,eV=eN.onCancel,eW=eN.onStartPayment,e_=eN.setUserHasAgreed,eH=eN.userHasAgreed,eK=eN.setShowLoadingModal,eG=eN.showLoadingModal,ez=eN.setLoadingModalStep,eJ=eN.loadingModalStep,eY=eN.setShowGetAccessBtn,eQ=eN.showGetAccessBtn,eX=eN.sourceIntegrationVersion,e2=eN.sourceIntegration,e3=(0,q.dd)(),e8=e3.isModalShown,e5=e3.closeModal,e9=e3.openModal,e7=(0,p.useState)(!1),e4=e7[0],e6=e7[1],tu=(0,h.v9)(ts.Fr),tp=(0,h.v9)(ts._S),td=(0,h.v9)(ts.Ae),th=(0,h.v9)(tr.z5),tf=(0,h.v9)(tr.hW),ty=(0,h.v9)(ta.kJ),tg=(0,h.v9)(to.WL);(0,h.v9)(to.LJ);var tm=null==eq?void 0:eq.submitForm,tb=L?ep.X.getDiscountDecimalAmount(s,L):s,tv=(0,N.t)({canSwapTokens:k,productQuantity:f,decimalAmount:tb,tokenSwapQuote:td}),tk=tv.balancesLoading,tT=tv.isBalanceEnough,tw=(0,O.Gn)(),tP=tw.isConnected,tS=tw.paymentAddress,tx=tw.paymentPublicKey,tO=tw.signBtcTransaction;z&&(null===(t=z.wallet)||void 0===t||t.type,x.WalletType.WEB3AUTH);var tC=(0,p.useCallback)(function(){Object.keys(eq.errors).length>0?eq.submitForm():e9()},[e9,eq]),tA=(0,p.useCallback)(function(e){eY(!1),eK(!1),eM(e)},[eM,eY,eK]),tR=!!(ey&&(null==eg?void 0:eg.symbol)===ej.l.get(ey)),tZ=eg&&(null===(n=eO.getCurrencyBySymbolAndOptionalBlockchain({symbol:eg.symbol,blockchain:ey}))||void 0===n?void 0:n.mintAddress),tE=(0,p.useMemo)(function(){if(eg&&tZ){var e=eC.convertToMinimalUnits({decimalAmount:s,symbol:null==eg?void 0:eg.symbol,blockchain:null==eg?void 0:eg.blockchain.symbol});return{sourceIntegration:e2,sourceIntegrationVersion:eX,recipientPK:i,symbol:eg.symbol,amount:e*(f?BigInt(f):BigInt(1)),paymentRequestId:c,blockchain:ey,onSuccess:tA,onError:eF,onInitiated:eU,onPending:eL,onCancel:eV,customerDetails:d,quantity:Number(f),productDetails:y,splitRevenue:m,splitWallets:b,discountToken:E,rateToken:eP,canSwapTokens:k,swapRouteToken:null==td?void 0:td.routeTokenString,discordProps:ev,accessCodeProps:ek,telegramUser:eT,mintAddress:tZ,affiliateCode:U}}},[ek,e2,eX,U,ey,k,eg,d,s,ev,E,tZ,eV,eF,eU,eL,c,y,f,eP,i,m,b,eC,null==td?void 0:td.routeTokenString,tA,eT]),tI=(0,p.useCallback)((0,w.Z)(S().mark(function e(){var t;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ez(el.T.SIGN_TRANSACTION),!(!tE||!K||!H||!G||!tZ||th)){e.next=3;break}return e.abrupt("return");case 3:return ee.kg.debug("OneTimePayment - starting Sol Payment flow, with discord auth (has token - ".concat(!!E),{discordAuth:ev}),t=tl({chargeId:null==tf?void 0:tf.id,chargeToken:null==tf?void 0:tf.token,anchorProvider:K,setLoadingModalStep:ez,wallet:H,connection:G.connection},tE),e.prev=5,e.next=8,new te(ed,eR,eZ,eE).handleTransaction(t);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(5),ee.kg.debug("OneTimePaymentWFButton SolCreatePaymentProps PaylinkSubmitService failed",{err:e.t0}),(0,ee.O7)(e.t0,"OneTimePaymentWFButton SolCreatePaymentProps PaylinkSubmitService failed");case 14:case"end":return e.stop()}},e,null,[[5,10]])})),[eE,ed,ev,E,eR,eZ,tE,ez,K,H,G,tZ,tf,th]),tB=(0,p.useCallback)((0,w.Z)(S().mark(function e(){var t,n,r;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!tE||!K||!H||!G||!tZ)){e.next=2;break}return e.abrupt("return");case 2:return t=tl({anchorProvider:K,wallet:H,connection:G.connection},tE),e6(!0),n="",e.prev=5,e.next=8,new te(ed,eR,eZ,eE).handleCreateCharge(t);case 8:n=e.sent.token,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),(0,ee.O7)(e.t0,"OneTimePaymentWFButton SolCreatePaymentProps PaylinkSubmitService failed");case 16:return r={pathname:"/charge/".concat(n)},e.next=19,eB(r);case 19:case"end":return e.stop()}},e,null,[[5,13]])})),[tE,K,H,G,tZ,ed,eR,eZ,eE,eB]),tD=(0,p.useCallback)((0,w.Z)(S().mark(function e(){var t;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ez(tR?el.T.SIGN_TRANSACTION:el.T.GET_PERMISSION),!(!tE||!em||!_)){e.next=3;break}return e.abrupt("return");case 3:if(t=tl({chargeId:null==tf?void 0:tf.id,chargeToken:null==tf?void 0:tf.token,anchorProvider:em,setLoadingModalStep:ez,isNativeMintAddress:tR},tE),ee.kg.debug("OneTimePayment - starting EVM ".concat(ey," Payment flow, with discord auth (has token - ").concat(!!E),{discordAuth:ev}),e.prev=5,ey!==x.BlockchainSymbol.POLYGON){e.next=9;break}return e.next=9,new e1(ed,eR,eZ,eE).handleTransaction(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(5),(0,ee.O7)(e.t0,"OneTimePaymentWFButton PolygonPaylinkSubmitService BlockchainSymbol.POLYGON failed");case 14:if(ey!==x.BlockchainSymbol.ETH){e.next=23;break}return e.prev=15,e.next=18,new e0(ed,eR,eZ,eE).handleTransaction(t);case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(15),(0,ee.O7)(e.t1,"OneTimePaymentWFButton EthPaylinkSubmitService BlockchainSymbol.ETH failed");case 23:if(ey!==x.BlockchainSymbol.BASE){e.next=32;break}return e.prev=24,e.next=27,new e$(ed,eR,eZ,eE).handleTransaction(t);case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(24),(0,ee.O7)(e.t2,"OneTimePaymentWFButton BasePaylinkSubmitService BlockchainSymbol.BASE failed");case 32:case"end":return e.stop()}},e,null,[[5,11],[15,20],[24,29]])})),[ez,eZ,tR,eE,tE,em,eR,_,ey,ed,E,ev,tf]),tj=(0,p.useCallback)((0,w.Z)(S().mark(function e(){var t,n;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ez(el.T.DEFAULT),!(!tE||!tP||!tS)){e.next=3;break}return e.abrupt("return");case 3:if(ee.kg.debug("OneTimePayment - starting BITCOIN ".concat(ey," Payment flow, with discord auth (has token - ").concat(!!E),{discordAuth:ev}),t=void 0,!V){e.next=23;break}return e.next=8,X("checkout");case 8:if(e.t1=n=e.sent,e.t0=null!==e.t1,!e.t0){e.next=12;break}e.t0=void 0!==n;case 12:if(!e.t0){e.next=16;break}e.t2=n,e.next=17;break;case 16:e.t2=void 0;case 17:if(t=e.t2){e.next=23;break}return(0,D.Jc)("Missing required captcha token - please try again"),(0,ee.O7)(V,"Missing captcha for bitcoin payment flow, but paylink requires it"),(0,ee.O7)(Error("Missing captcha for bitcoin payment flow, but paylink requires it")),e.abrupt("return");case 23:return e.prev=23,e.next=26,new eD({connection:{paymentAddress:tS,signBtcTransaction:tO,paymentPublicKey:tx},generalNetwork:eR,helioApiAdapter:ed,platform:eZ,apiBasePath:eE},null==tf?void 0:tf.id,null==tf?void 0:tf.token).handleTransaction(tl(tl({},tE),{},{captchaToken:t}));case 26:e.next=32;break;case 28:e.prev=28,e.t3=e.catch(23),(0,ee.O7)(e.t3,"OneTimePaymentWFButton BitcoinPaylinkSubmitService failed"),(0,ee.O7)(e.t3,"OneTimePaymentWFButton BitcoinPaylinkSubmitService failed");case 32:case"end":return e.stop()}},e,null,[[23,28]])})),[X,ez,eE,tf,tE,eZ,tP,tS,ey,eR,ed,E,ev,tO,tx,V]),tq=(0,p.useCallback)((0,w.Z)(S().mark(function e(){var t;return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==eW||eW(),eK(!0),e_(!0),ey){e.next=6;break}return(0,ee.O7)(Error("Starting payment (with loading modal) but no blockchain")),e.abrupt("return");case 6:if(null==Y||Y("".concat(s.multipliedBy(f||1)," ").concat(null==tE?void 0:tE.symbol)),!(null!=tf&&tf.token&&eg)){e.next=21;break}if(eP){e.next=10;break}throw Error("Charge was trying to prepare, but lacked a rate token");case 10:return e.prev=10,t={currency:eg.symbol,amount:s.times(f||1).times(Math.pow(10,eg.decimals)).toFixed(),quantity:Number(null!=f?f:1),pricingCurrencyRateToken:eP,customerDetails:I()(d)?void 0:d,productDetails:I()(y)?void 0:y},ee.kg.debug("About to update charge with currency/amount/quantity/token - ".concat(JSON.stringify(t))),e.next=15,ed.updateCharge(tf.token,t);case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(10),ee.kg.error("Error updating charge token just before a one time payment"),(0,ee.O7)(e.t0);case 21:e.t1=ey,e.next=e.t1===x.BlockchainSymbol.SOL?24:e.t1===x.BlockchainSymbol.BITCOIN?26:e.t1===x.BlockchainSymbol.ETH?28:e.t1===x.BlockchainSymbol.POLYGON?28:e.t1===x.BlockchainSymbol.BASE?28:30;break;case 24:return tI(),e.abrupt("break",31);case 26:return tj(),e.abrupt("break",31);case 28:return tD(),e.abrupt("break",31);case 30:(0,j.Fi)(ey);case 31:case"end":return e.stop()}},e,null,[[10,17]])})),[tf,eg,eP,eW,ed,eK,e_,ey,Y,s,f,null==tE?void 0:tE.symbol,tI,tD,tj,d,y]),tN=(0,ec.i)({onContinue:tq,onDismiss:void 0===T?function(){}:T,userHasAgreed:eH}),tM=tN.startUnverifiedWarningModal,tL=tN.unverifiedWarningModalProps;(0,p.useEffect)(function(){u&&!eH&&tM()},[u,eH,tM]),(0,p.useEffect)(function(){tg&&(null==tm||tm())},[tg,tm]);var tF=function(){var e;return eg&&null!==(e=x.CommonCurrencyService.minValueFromCurrencyMinDecimals(eg))&&void 0!==e?e:(0,R.Z)(0)},tU=ey!==x.BlockchainSymbol.BITCOIN||s.times(f||1).gte(tF()),tV=tU?"Not enough funds in your wallet":"Minimum payment amount is ".concat(tF().toFixed()),tW=eS||k&&!!tu||tp||ty||!tT||F||!tU;return(0,g.jsxs)(g.Fragment,{children:[eQ&&((null==z||null===(r=z.wallet)||void 0===r?void 0:r.type)!==x.WalletType.WEB3AUTH||tT?(0,g.jsxs)(g.Fragment,{children:[null!=tf&&tf.token?"":eI&&(0,g.jsx)(ea.z,{type:"button",onClick:tB,className:"hel-text-sm hel-rounded-full",variant:"primary",isLoading:e4,children:"Create Charge"}),(0,g.jsx)(eo.g,{type:l,onClick:(0,w.Z)(S().mark(function e(){return S().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","submit"!==l&&tM());case 1:case"end":return e.stop()}},e)})),isDropShadow:eh,className:"hel-text-sm hel-rounded-full",variant:"primary","data-testid":ti.H.checkoutForm.primaryPayButton,disabled:tW,showTooltip:!tT||!tU,tooltipTitle:tV,tooltipClassName:"hel-flex hel-flex-col",isLoading:tk,showLoadingMessage:tk,children:tk?eu.LE:J||(void 0===P?"PAY":P)})]}):(0,g.jsx)(tc,{openAddFundsModal:tC,isAddFundsModalShown:e8,balancesLoading:tk})),(0,g.jsx)(ec.b,tl({},tL)),e8&&eg&&(null==z||null===(a=z.wallet)||void 0===a?void 0:a.publicKey)&&(0,g.jsx)(ei.wQ,{publicKey:z.wallet.publicKey,onHide:e5,decimalAmount:tb.times(f||1),initialCurrency:eg,supportedCurrencies:null!==(o=null==W?void 0:W.map(function(e){return e.currency}))&&void 0!==o?o:[eg],usePaymentMethodModal:!0}),eG&&(0,g.jsx)(es.R,{step:eJ,onHide:function(){return eK(!1)}})]})};n(7051);var td=n(73927);function th(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?th(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):th(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var ty=function(e){var t=(0,h.I0)(),n=(0,k.uV)().actions,r=(0,h.v9)(T.TC),a=(0,h.v9)(T.Qk),o=(0,h.v9)(v.cs);return(0,p.useEffect)(function(){(e.paymentData.requireMaxTransactions||e.paymentData.isHelioPlay)&&t(n.loadPaylinkVolume({paymentRequestId:e.paymentData.id}))},[n,t,e.paymentData.id,e.paymentData.isHelioPlay,e.paymentData.requireMaxTransactions]),(0,g.jsx)(td.z,tf(tf({},e),{},{PaymentButton:tp,PaymentRequestNfts:f.T,TotalPriceBanner:b,nfts:o,volume:r,volumeLoading:a}))},tg=function(e){var t=e.isCharge,n=e.paymentRequest,r=e.decimalAmount,a=e.setDecimalAmount,o=(0,p.useState)(!1),s=o[0],i=o[1];return(0,g.jsx)(d.c,{isCharge:t,paymentRequest:n,AccessCard:ty,decimalAmount:r,setDecimalAmount:a,hasCanceledRedirect:s,setHasCanceledRedirect:i})},tm=n(31545),tb=n(26815),tv=function(e){var t,n,r,a,o=e.blockchain,s=e.canChangePrice,i=e.company,c=e.currencySymbol,u=e.customCheckoutTheme,l=e.decimalAmount,p=e.description,d=e.hasCustomCheckoutTheme,f=e.imageUrl,y=e.additionalImageUrls,m=e.isHelioPlay,b=e.kycVerified,v=e.merchantPublicKey,k=e.name,T=e.paymentRequestLink,w=e.revealedVideoUrl,P=(0,h.v9)(tr.qx),S=(0,M.U)(),x=S.tokenConversionService,O=S.currencyService;if(c&&l&&o){var C=O.getCurrencyBySymbolAndOptionalBlockchain({symbol:c,blockchain:o});a=C?x.formatPrice({decimalAmount:l,currency:C}):"-"}return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(tb.i,{affiliatePercent:(null==P||null===(t=P.affiliateDetails)||void 0===t?void 0:t.bps)&&tm.i.BPSToPercent(null==P?void 0:P.affiliateDetails.bps),allowAffiliate:null==P?void 0:P.allowAffiliate,company:i,customCheckoutTheme:u,description:p,eventDetails:null==P?void 0:P.eventDetails,hasCustomCheckoutTheme:d,imageUrl:f,additionalImageUrls:y,isEventEnabled:null==P?void 0:P.isEventEnabled,isHelioPlay:void 0!==m&&m,kycVerified:b,merchantPublicKey:v,name:k,paymentRequestBlockchain:o,paymentRequestLink:T,previewUrl:null==P||null===(n=P.helioPlayProperties)||void 0===n?void 0:n.previewUrl,pricing:void 0!==s&&s?"":"".concat(a," ").concat(c),revealedVideoUrl:w,videoDuration:null==P||null===(r=P.helioPlayProperties)||void 0===r?void 0:r.durationSec})})},tk=["isCharge"];function tT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var tw=function(e){var t=e.isCharge,n=(0,c.Z)(e,tk);return(0,g.jsx)(l.b,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tT(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tT(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({PaymentCard:tg,ContentInfoCard:t?u._:tv,isCharge:t},n))}}}]);